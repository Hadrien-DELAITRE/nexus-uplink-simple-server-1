"use strict";

var _classProps = function (child, staticProps, instanceProps) {
  if (staticProps) Object.defineProperties(child, staticProps);
  if (instanceProps) Object.defineProperties(child.prototype, instanceProps);
};

require("6to5/polyfill");
var Promise = require("bluebird");
var io = require("socket.io");
var _ = require("lodash");
var co = require("co");
var EventEmitter = require("events").EventEmitter;
var bodyParser = require("body-parser");
var ConstantRouter = require("nexus-router").ConstantRouter;

var Connection = require("./Connection");
var Session = require("./Session");
var HTTPError = require("./HTTPError");

var UplinkSimpleServer = (function () {
  var UplinkSimpleServer = function UplinkSimpleServer(_ref) {
    var pid = _ref.pid;
    var stores = _ref.stores;
    var rooms = _ref.rooms;
    var actions = _ref.actions;
    _.dev(function () {
      return stores.should.be.an.Array && rooms.should.be.an.Array && actions.should.be.an.Array;
    });
    this.stores = new ConstantRouter(stores);
    this.rooms = new ConstantRouter(rooms);
    this.actions = new ConstantRouter(actions);
    this._data = {};
  };

  _classProps(UplinkSimpleServer, null, {
    pull: {
      writable: true,
      value: function (path) {
        if (this.stores.match(path) !== null) {}
      }
    },
    subscribeTo: {
      writable: true,
      value: function (path, update) {}
    },
    unsubscribeFrom: {
      writable: true,
      value: function (subscription) {}
    },
    listenTo: {
      writable: true,
      value: function (room, emit) {}
    },
    unlistenTo: {
      writable: true,
      value: function (listener) {}
    },
    dispatch: {
      writable: true,
      value: function (action, params) {}
    }
  });

  return UplinkSimpleServer;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImY6L1VzZXJzL0VsaWUvZ2l0L3JlYWN0L25leHVzLXVwbGluay1zaW1wbGUtc2VydmVyL3NyYy9VcGxpbmtTaW1wbGVTZXJ2ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUN6QixJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDbEMsSUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ2hDLElBQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUM1QixJQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDekIsSUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQztBQUNwRCxJQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDMUMsSUFBTSxjQUFjLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLGNBQWMsQ0FBQzs7QUFFOUQsSUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQzNDLElBQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUNyQyxJQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7O0lBRW5DLGtCQUFrQjtNQUFsQixrQkFBa0IsR0FJWCxTQUpQLGtCQUFrQixPQUl1QjtRQUEvQixHQUFHLFFBQUgsR0FBRztRQUFFLE1BQU0sUUFBTixNQUFNO1FBQUUsS0FBSyxRQUFMLEtBQUs7UUFBRSxPQUFPLFFBQVAsT0FBTztBQUN2QyxLQUFDLENBQUMsR0FBRyxDQUFDO2FBQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssSUFDbkMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUssSUFDeEIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEtBQUs7S0FBQSxDQUMzQixDQUFDO0FBQ0YsUUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUN6QyxRQUFJLENBQUMsS0FBSyxHQUFHLElBQUksY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3ZDLFFBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDM0MsUUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7R0FDakI7O2NBYkcsa0JBQWtCO0FBZXRCLFFBQUk7O2FBQUEsVUFBQyxJQUFJLEVBQUU7QUFDVCxZQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRSxFQUVwQztPQUNGOztBQUVELGVBQVc7O2FBQUEsVUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEVBRXpCOztBQUVELG1CQUFlOzthQUFBLFVBQUMsWUFBWSxFQUFFLEVBRTdCOztBQUVELFlBQVE7O2FBQUEsVUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBRXBCOztBQUVELGNBQVU7O2FBQUEsVUFBQyxRQUFRLEVBQUUsRUFFcEI7O0FBRUQsWUFBUTs7YUFBQSxVQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFFeEI7Ozs7U0F2Q0csa0JBQWtCIiwiZmlsZSI6IlVwbGlua1NpbXBsZVNlcnZlci5qcyIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJzZ0bzUvcG9seWZpbGwnKTtcbnZhciBQcm9taXNlID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcbmNvbnN0IGlvID0gcmVxdWlyZSgnc29ja2V0LmlvJyk7XG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5jb25zdCBjbyA9IHJlcXVpcmUoJ2NvJyk7XG5jb25zdCBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCdldmVudHMnKS5FdmVudEVtaXR0ZXI7XG5jb25zdCBib2R5UGFyc2VyID0gcmVxdWlyZSgnYm9keS1wYXJzZXInKTtcbmNvbnN0IENvbnN0YW50Um91dGVyID0gcmVxdWlyZSgnbmV4dXMtcm91dGVyJykuQ29uc3RhbnRSb3V0ZXI7XG5cbmNvbnN0IENvbm5lY3Rpb24gPSByZXF1aXJlKCcuL0Nvbm5lY3Rpb24nKTtcbmNvbnN0IFNlc3Npb24gPSByZXF1aXJlKCcuL1Nlc3Npb24nKTtcbmNvbnN0IEhUVFBFcnJvciA9IHJlcXVpcmUoJy4vSFRUUEVycm9yJyk7XG5cbmNsYXNzIFVwbGlua1NpbXBsZVNlcnZlciB7XG4gIC8vIHN0b3Jlcywgcm9vbXMsIGFuZCBhY3Rpb25zIGFyZSB0aHJlZSB3aGl0ZWxpc3RzIG9mXG4gIC8vIHN0cmluZyBwYXR0ZXJucy4gRWFjaCBpcyBhbiBhcnJheSB0aGF0IHdpbGwgYmUgcGFzc2VkXG4gIC8vIHRvIHRoZSBSb3V0ZXIgY29uc3RydWN0b3IuXG4gIGNvbnN0cnVjdG9yKHsgcGlkLCBzdG9yZXMsIHJvb21zLCBhY3Rpb25zIH0pIHtcbiAgICBfLmRldigoKSA9PiBzdG9yZXMuc2hvdWxkLmJlLmFuLkFycmF5ICYmXG4gICAgICByb29tcy5zaG91bGQuYmUuYW4uQXJyYXkgJiZcbiAgICAgIGFjdGlvbnMuc2hvdWxkLmJlLmFuLkFycmF5XG4gICAgKTtcbiAgICB0aGlzLnN0b3JlcyA9IG5ldyBDb25zdGFudFJvdXRlcihzdG9yZXMpO1xuICAgIHRoaXMucm9vbXMgPSBuZXcgQ29uc3RhbnRSb3V0ZXIocm9vbXMpO1xuICAgIHRoaXMuYWN0aW9ucyA9IG5ldyBDb25zdGFudFJvdXRlcihhY3Rpb25zKTtcbiAgICB0aGlzLl9kYXRhID0ge307XG4gIH1cblxuICBwdWxsKHBhdGgpIHtcbiAgICBpZih0aGlzLnN0b3Jlcy5tYXRjaChwYXRoKSAhPT0gbnVsbCkge1xuXG4gICAgfVxuICB9XG5cbiAgc3Vic2NyaWJlVG8ocGF0aCwgdXBkYXRlKSB7XG5cbiAgfVxuXG4gIHVuc3Vic2NyaWJlRnJvbShzdWJzY3JpcHRpb24pIHtcblxuICB9XG5cbiAgbGlzdGVuVG8ocm9vbSwgZW1pdCkge1xuXG4gIH1cblxuICB1bmxpc3RlblRvKGxpc3RlbmVyKSB7XG5cbiAgfVxuXG4gIGRpc3BhdGNoKGFjdGlvbiwgcGFyYW1zKSB7XG5cbiAgfVxufVxuXG4vLyAvKipcbi8vICogPHA+IFNpbXBsZVVwbGlua1NlcnZlciByZXByZXNlbnRzIGFuIHVwbGluay1zZXJ2ZXIgdGhhdCB3aWxsIGJlIGFibGUgdG8gc3RvcmUgZGF0YSB2aWEgYW4gb3RoZXIgc2VydmVyLjxiciAvPlxuLy8gKiBUaGVyZSBhbHNvIHdpbGwgYmUgYWJsZSB0byBub3RpZnkgZWFjaCBjbGllbnQgd2hvIHN1c2NyaWJlcyB0byBhIGRhdGEgd2hlbiBhbiB1cGRhdGUgd2lsbCBvY2N1cnMgdGhhbmtzIHRvIHNvY2tldCA8L3A+XG4vLyAqIDxwPiBTaW1wbGVVcGxpbmtTZXJ2ZXIgd2lsbCBiZSByZXF1ZXN0ZWQgYnkgR0VUIG9yIFBPU1QgdmlhIFIuVXBsaW5rIHNlcnZlci1zaWRlIGFuZCBjbGllbnQtc2lkZVxuLy8gKiBAY2xhc3MgUi5TaW1wbGVVcGxpbmtTZXJ2ZXJcbi8vICovXG4vLyBjbGFzcyBTaW1wbGVVcGxpbmtTZXJ2ZXIge1xuXG4vLyAgICAgLyoqXG4vLyAgICAgKiA8cD4gSW5pdGlhbGl6ZXMgdGhlIFNpbXBsZVVwbGlua1NlcnZlciBhY2NvcmRpbmcgdG8gdGhlIHNwZWNpZmljYXRpb25zIHByb3ZpZGVkIDwvcD5cbi8vICAgICAqIEBtZXRob2QgY3JlYXRlQXBwXG4vLyAgICAgKiBAcGFyYW0ge29iamVjdH0gc3BlY3MgQWxsIHRoZSBzcGVjaWZpY2F0aW9ucyBvZiB0aGUgU2ltcGxlVXBsaW5rU2VydmVyXG4vLyAgICAgKiBAcmV0dXJuIHtTaW1wbGVVcGxpbmtTZXJ2ZXJJbnN0YW5jZX0gU2ltcGxlVXBsaW5rU2VydmVySW5zdGFuY2UgVGhlIGluc3RhbmNlIG9mIHRoZSBjcmVhdGVkIFNpbXBsZVVwbGlua1NlcnZlclxuLy8gICAgICovXG4vLyAgICAgY29uc3RydWN0b3Ioc3BlY3Mpe1xuLy8gICAgICAgXy5kZXYoKCkgPT5cbi8vICAgICAgICAgc3BlY3Muc3RvcmUuc2hvdWxkLmJlLmFuLkFycmF5ICYmXG4vLyAgICAgICAgIHNwZWNzLmV2ZW50cy5zaG91bGQuYmUuYW4uQXJyYXkgJiZcbi8vICAgICAgICAgc3BlY3MuYWN0aW9uLnNob3VsZC5iZS5vayAmJiBfLmlzUGxhaW5PYmplY3Qoc3BlY3MuYWN0aW9ucykgJiZcbi8vICAgICAgICAgc3BlY3Muc2Vzc2lvbkNyZWF0ZWQuc2hvdWxkLmJlLmEuRnVuY3Rpb24gJiZcbi8vICAgICAgICAgc3BlY3Muc2Vzc2lvblRpbWVvdXQuc2hvdWxkLmJlLmEuTnVtYmVyXG4vLyAgICAgICAgICk7XG5cbi8vICAgICAgIHRoaXMuX3NwZWNzID0gc3BlY3M7XG4vLyAgICAgICB0aGlzLl9waWQgPSBSLmd1aWQoJ1NpbXBsZVVwbGlua1NlcnZlcicpO1xuLy8gICAgICAgdGhpcy5fc3RvcmUgPSB7fTtcbi8vICAgICAgIHRoaXMuX2hhc2hlcyA9IHt9O1xuLy8gICAgICAgdGhpcy5fc3RvcmVSb3V0ZXIgPSBuZXcgUi5Sb3V0ZXIoKTtcbi8vICAgICAgIHRoaXMuX3N0b3JlUm91dGVyLmRlZihfLmNvbnN0YW50KHtcbi8vICAgICAgICAgZXJyOiAnVW5rbm93biBzdG9yZSBrZXknLFxuLy8gICAgICAgfSkpO1xuLy8gICAgICAgdGhpcy5fc3RvcmVFdmVudHMgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4vLyAgICAgICB0aGlzLl9ldmVudHNSb3V0ZXIgPSBuZXcgUi5Sb3V0ZXIoKTtcbi8vICAgICAgIHRoaXMuX2V2ZW50c1JvdXRlci5kZWYoXy5jb25zdGFudCh7XG4vLyAgICAgICAgIGVycjogJ1Vua25vd24gZXZlbnQgbmFtZScsXG4vLyAgICAgICB9KSk7XG4vLyAgICAgICB0aGlzLl9ldmVudHNFdmVudHMgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4vLyAgICAgICB0aGlzLl9hY3Rpb25zUm91dGVyID0gbmV3IFIuUm91dGVyKCk7XG4vLyAgICAgICB0aGlzLl9hY3Rpb25zUm91dGVyLmRlZihfLmNvbnN0YW50KHtcbi8vICAgICAgICAgZXJyOiAnVW5rbm93biBhY3Rpb24nLFxuLy8gICAgICAgfSkpO1xuLy8gICAgICAgdGhpcy5fc2Vzc2lvbnMgPSB7fTtcbi8vICAgICAgIHRoaXMuX3Nlc3Npb25zRXZlbnRzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuLy8gICAgICAgdGhpcy5fY29ubmVjdGlvbnMgPSB7fTtcblxuLy8gICAgICAgdGhpcy5fbGlua1Nlc3Npb24gPSBSLnNjb3BlKHRoaXMuX2xpbmtTZXNzaW9uLCB0aGlzKTtcbi8vICAgICAgIHRoaXMuX3VubGlua1Nlc3Npb24gPSBSLnNjb3BlKHRoaXMuX3VubGlua1Nlc3Npb24sIHRoaXMpO1xuLy8gICAgIH1cblxuLy8gICAgIC8qKlxuLy8gICAgICogPHA+U2F2ZXMgZGF0YSBpbiBzdG9yZS5cbi8vICAgICAqIENhbGxlZCBieSBhbm90aGVyIHNlcnZlciB0aGF0IHdpbGwgcHJvdmlkZSBkYXRhIGZvciBlYWNoIHVwZGF0ZWQgZGF0YSA8L3A+XG4vLyAgICAgKiBAbWV0aG9kIHNldFN0b3JlXG4vLyAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBzcGVjaWZpZWQga2V5IHRvIHNldFxuLy8gICAgICogQHBhcmFtIHtzdHJpbmd9IHZhbCBUaGUgdmFsdWUgdG8gc2F2ZVxuLy8gICAgICogQHJldHVybiB7ZnVuY3Rpb259XG4vLyAgICAgKi9cbi8vICAgICBzZXRTdG9yZShrZXksIHZhbCkge1xuLy8gICAgICAgcmV0dXJuIChmbikgPT4ge1xuLy8gICAgICAgICB0cnkge1xuLy8gICAgICAgICAgIGxldCBwcmV2aW91c1ZhbCA9IHRoaXMuX3N0b3JlW2tleV0gfHwge307XG4vLyAgICAgICAgICAgbGV0IHByZXZpb3VzSGFzaCA9IHRoaXMuX2hhc2hlc1trZXldIHx8IFIuaGFzaChKU09OLnN0cmluZ2lmeShwcmV2aW91c1ZhbCkpO1xuLy8gICAgICAgICAgIGxldCBkaWZmID0gUi5kaWZmKHByZXZpb3VzVmFsLCB2YWwpO1xuLy8gICAgICAgICAgIGxldCBoYXNoID0gUi5oYXNoKEpTT04uc3RyaW5naWZ5KHZhbCkpO1xuLy8gICAgICAgICAgIHRoaXMuX3N0b3JlW2tleV0gPSB2YWw7XG4vLyAgICAgICAgICAgdGhpcy5faGFzaGVzW2tleV0gPSBoYXNoO1xuLy8gICAgICAgICAgIHRoaXMuX3N0b3JlRXZlbnRzLmVtaXQoJ3NldDonICsga2V5LCB7XG4vLyAgICAgICAgICAgICBrOiBrZXksXG4vLyAgICAgICAgICAgICBkOiBkaWZmLFxuLy8gICAgICAgICAgICAgaDogcHJldmlvdXNIYXNoLFxuLy8gICAgICAgICAgIH0pO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGNhdGNoKGVycikge1xuLy8gICAgICAgICAgIHJldHVybiBmbihSLkRlYnVnLmV4dGVuZEVycm9yKGVyciwgJ1IuU2ltcGxlVXBsaW5rU2VydmVyLnNldFN0b3JlKFxcJycgKyBrZXkgKyAnXFwnLCBcXCcnICsgdmFsICsgJ1xcJyknKSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgXy5kZWZlcigoKSA9PiB7XG4vLyAgICAgICAgICAgZm4obnVsbCwgdmFsKTtcbi8vICAgICAgICAgfSk7XG4vLyAgICAgICB9O1xuLy8gICAgIH1cblxuLy8gICAgIC8qKlxuLy8gICAgICogPHA+IFByb3ZpZGVzIGRhdGEgZnJvbSBzdG9yZS4gPGJyIC8+XG4vLyAgICAgKiBDYWxsZWQgd2hlbiB0aGUgZmV0Y2hpbmcgZGF0YSBvY2N1cnMuIDxiciAvPlxuLy8gICAgICogUmVxdWVzdGVkIGJ5IEdFVCBmcm9tIFIuU3RvcmUgc2VydmVyLXNpZGUgb3IgY2xpZW50LXNpZGU8L3A+XG4vLyAgICAgKiBAbWV0aG9kIGdldFN0b3JlXG4vLyAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBzcGVjaWZpZWQga2V5IHRvIHNldFxuLy8gICAgICogQHJldHVybiB7ZnVuY3Rpb259XG4vLyAgICAgKi9cbi8vICAgICBnZXRTdG9yZShrZXkpIHtcbi8vICAgICAgIHJldHVybiAoZm4pID0+IHtcbi8vICAgICAgICAgbGV0IHZhbDtcbi8vICAgICAgICAgdHJ5IHtcbi8vICAgICAgICAgICBfLmRldigoKSA9PiB7XG4vLyAgICAgICAgICAgICBpZighXy5oYXModGhpcy5fc3RvcmUsIGtleSkpIHtcbi8vICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdSLlNpbXBsZVVwbGlua1NlcnZlciguLi4pLmdldFN0b3JlOiBubyBzdWNoIGtleSAoJyArIGtleSArICcpJyk7XG4vLyAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgfSk7XG4vLyAgICAgICAgICAgdmFsID0gdGhpcy5fc3RvcmVba2V5XTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBjYXRjaChlcnIpIHtcbi8vICAgICAgICAgICByZXR1cm4gZm4oUi5EZWJ1Zy5leHRlbmRFcnJvcihlcnIsICdSLlNpbXBsZVVwbGlua1NlcnZlci5nZXRTdG9yZShcXCcnICsga2V5ICsgJ1xcJyknKSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgXy5kZWZlcigoKSA9PiB7XG4vLyAgICAgICAgICAgZm4obnVsbCwgdmFsKTtcbi8vICAgICAgICAgfSk7XG4vLyAgICAgICB9O1xuLy8gICAgIH1cbi8vICAgICAvKipcbi8vICAgICAqIEBtZXRob2QgZW1pdEV2ZW50XG4vLyAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnROYW1lXG4vLyAgICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zXG4vLyAgICAgKi9cbi8vICAgICBlbWl0RXZlbnQoZXZlbnROYW1lLCBwYXJhbXMpIHtcbi8vICAgICAgIHRoaXMuX2V2ZW50c0V2ZW50cy5lbWl0KCdlbWl0OicgKyBldmVudE5hbWUsIHBhcmFtcyk7XG4vLyAgICAgfVxuLy8gICAgIC8qKlxuLy8gICAgICogQG1ldGhvZCBlbWl0RGVidWdcbi8vICAgICAqIEBwYXJhbSB7c3RyaW5nfSBndWlkXG4vLyAgICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zXG4vLyAgICAgKi9cbi8vICAgICBlbWl0RGVidWcoZ3VpZCwgcGFyYW1zKSB7XG4vLyAgICAgICBfLmRldigoKSA9PiB7XG4vLyAgICAgICAgIGlmKHRoaXMuX3Nlc3Npb25zW2d1aWRdKSB7XG4vLyAgICAgICAgICAgdGhpcy5fc2Vzc2lvbnNbZ3VpZF0uZW1pdCgnZGVidWcnLCBwYXJhbXMpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICB9KTtcbi8vICAgICB9XG4vLyAgICAgLyoqXG4vLyAgICAgKiBAbWV0aG9kIGVtaXRMb2dcbi8vICAgICAqIEBwYXJhbSB7c3RyaW5nfSBndWlkXG4vLyAgICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zXG4vLyAgICAgKi9cbi8vICAgICBlbWl0TG9nKGd1aWQsIHBhcmFtcykge1xuLy8gICAgICAgaWYodGhpcy5fc2Vzc2lvbnNbZ3VpZF0pIHtcbi8vICAgICAgICAgdGhpcy5fc2Vzc2lvbnNbZ3VpZF0uZW1pdCgnbG9nJywgcGFyYW1zKTtcbi8vICAgICAgIH1cbi8vICAgICB9XG4vLyAgICAgLyoqXG4vLyAgICAgKiBAbWV0aG9kIGVtaXRXYXJuXG4vLyAgICAgKiBAcGFyYW0ge3N0cmluZ30gZ3VpZFxuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtc1xuLy8gICAgICovXG4vLyAgICAgZW1pdFdhcm4oZ3VpZCwgcGFyYW1zKSB7XG4vLyAgICAgICBpZih0aGlzLl9zZXNzaW9uc1tndWlkXSkge1xuLy8gICAgICAgICB0aGlzLl9zZXNzaW9uc1tndWlkXS5lbWl0KCd3YXJuJywgcGFyYW1zKTtcbi8vICAgICAgIH1cbi8vICAgICB9XG4vLyAgICAgLyoqXG4vLyAgICAgKiBAbWV0aG9kIGVtaXRFcnJvclxuLy8gICAgICogQHBhcmFtIHtzdHJpbmd9IGd1aWRcbi8vICAgICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXNcbi8vICAgICAqL1xuLy8gICAgIGVtaXRFcnJvcihndWlkLCBwYXJhbXMpIHtcbi8vICAgICAgIGlmKHRoaXMuX3Nlc3Npb25zW2d1aWRdKSB7XG4vLyAgICAgICAgIHRoaXMuX3Nlc3Npb25zW2d1aWRdLmVtaXQoJ2VycicsIHBhcmFtcyk7XG4vLyAgICAgICB9XG4vLyAgICAgfVxuLy8gICAgIF9leHRyYWN0T3JpZ2luYWxQYXRoKCkge1xuLy8gICAgICAgcmV0dXJuIGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV07XG4vLyAgICAgfVxuLy8gICAgIF9iaW5kU3RvcmVSb3V0ZShyb3V0ZSkge1xuLy8gICAgICAgdGhpcy5fc3RvcmVSb3V0ZXIucm91dGUocm91dGUsIHRoaXMuX2V4dHJhY3RPcmlnaW5hbFBhdGgpO1xuLy8gICAgIH1cbi8vICAgICBfYmluZEV2ZW50c1JvdXRlKHJvdXRlKSB7XG4vLyAgICAgICB0aGlzLl9ldmVudHNSb3V0ZXIucm91dGUocm91dGUsIHRoaXMuX2V4dHJhY3RPcmlnaW5hbFBhdGgpO1xuLy8gICAgIH1cbi8vICAgICBfYmluZEFjdGlvbnNSb3V0ZShoYW5kbGVyLCByb3V0ZSkge1xuLy8gICAgICAgdGhpcy5fYWN0aW9uc1JvdXRlci5yb3V0ZShyb3V0ZSwgXy5jb25zdGFudChSLnNjb3BlKGhhbmRsZXIsIHRoaXMpKSk7XG4vLyAgICAgfVxuLy8gICAgIC8qKlxuLy8gICAgICogPHA+IFNldHRpbmcgdXAgVXBsaW5rU2VydmVyLiA8YnIgLz5cbi8vICAgICAqIC0gY3JlYXRlIHRoZSBzb2NrZXQgY29ubmVjdGlvbiA8YnIgLz5cbi8vICAgICAqIC0gaW5pdCBnZXQgYW5kIHBvc3QgYXBwIGluIG9yZGVyIHRvIHByb3ZpZGUgZGF0YSB2aWEgUi5VcGxpbmsuZmV0Y2g8L3A+XG4vLyAgICAgKiBAbWV0aG9kIGluc3RhbGxIYW5kbGVyc1xuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IGFwcCBUaGUgc3BlY2lmaWVkIEFwcFxuLy8gICAgICogQHBhcmFtIHtzdHJpbmd9IHByZWZpeCBUaGUgcHJlZml4IHN0cmluZyB0aGF0IHdpbGwgYmUgcmVxdWVzdGVkLiBUaXBpY2FsbHkgXCIvdXBsaW5rXCJcbi8vICAgICAqL1xuLy8gICAgIGluc3RhbGxIYW5kbGVycyhhcHAsIHByZWZpeCkge1xuLy8gICAgICAgcmV0dXJuIF8uY29wcm9taXNlKGZ1bmN0aW9uKigpIHtcbi8vICAgICAgICAgXy5kZXYoKCkgPT4gKHRoaXMuX2FwcCA9PT0gbnVsbCkuc2hvdWxkLmJlLm9rKTtcbi8vICAgICAgICAgdGhpcy5fYXBwID0gYXBwO1xuLy8gICAgICAgICB0aGlzLl9wcmVmaXggPSBwcmVmaXggfHwgJy91cGxpbmsvJztcbi8vICAgICAgICAgbGV0IHNlcnZlciA9IHJlcXVpcmUoJ2h0dHAnKS5TZXJ2ZXIoYXBwKTtcbi8vICAgICAgICAgdGhpcy5faW8gPSBpbyhzZXJ2ZXIpLm9mKHByZWZpeCk7XG4vLyAgICAgICAgIHRoaXMuX2FwcC5nZXQodGhpcy5fcHJlZml4ICsgJyonLCBSLnNjb3BlKHRoaXMuX2hhbmRsZUh0dHBHZXQsIHRoaXMpKTtcbi8vICAgICAgICAgdGhpcy5fYXBwLnBvc3QodGhpcy5fcHJlZml4ICsgJyonLCBib2R5UGFyc2VyLmpzb24oKSwgUi5zY29wZSh0aGlzLl9oYW5kbGVIdHRwUG9zdCwgdGhpcykpO1xuLy8gICAgICAgICB0aGlzLl9pby5vbignY29ubmVjdGlvbicsIFIuc2NvcGUodGhpcy5faGFuZGxlU29ja2V0Q29ubmVjdGlvbiwgdGhpcykpO1xuLy8gICAgICAgICB0aGlzLl9oYW5kbGVTb2NrZXREaXNjb25uZWN0aW9uID0gUi5zY29wZSh0aGlzLl9oYW5kbGVTb2NrZXREaXNjb25uZWN0aW9uLCB0aGlzKTtcbi8vICAgICAgICAgdGhpcy5fc2Vzc2lvbnNFdmVudHMuYWRkTGlzdGVuZXIoJ2V4cGlyZScsIFIuc2NvcGUodGhpcy5faGFuZGxlU2Vzc2lvbkV4cGlyZSwgdGhpcykpO1xuLy8gICAgICAgICBfLmVhY2godGhpcy5fc3BlY3Muc3RvcmUsIFIuc2NvcGUodGhpcy5fYmluZFN0b3JlUm91dGUsIHRoaXMpKTtcbi8vICAgICAgICAgXy5lYWNoKHRoaXMuX3NwZWNzLmV2ZW50cywgUi5zY29wZSh0aGlzLl9iaW5kRXZlbnRzUm91dGUsIHRoaXMpKTtcbi8vICAgICAgICAgXy5lYWNoKHRoaXMuX3NwZWNzLmFjdGlvbnMsIFIuc2NvcGUodGhpcy5fYmluZEFjdGlvbnNSb3V0ZSwgdGhpcykpO1xuLy8gICAgICAgICB0aGlzLmJvb3RzdHJhcCA9IFIuc2NvcGUodGhpcy5fc3BlY3MuYm9vdHN0cmFwLCB0aGlzKTtcbi8vICAgICAgICAgeWllbGQgdGhpcy5ib290c3RyYXAoKTtcbi8vICAgICAgICAgcmV0dXJuIHNlcnZlcjtcbi8vICAgICAgIH0sIHRoaXMpO1xuLy8gfVxuXG4vLyAgICAgLyoqXG4vLyAgICAgKiA8cD5SZXR1cm4gdGhlIHNhdmVkIGRhdGEgZnJvbSBzdG9yZTwvcD5cbi8vICAgICAqIDxwPlJlcXVlc3RlZCBmcm9tIFIuU3RvcmUgc2VydmVyLXNpZGUgb3IgY2xpZW50LXNpZGU8L3A+XG4vLyAgICAgKiBAbWV0aG9kIF9oYW5kbGVIdHRwR2V0XG4vLyAgICAgKiBAcGFyYW0ge29iamVjdH0gcmVxIFRoZSBjbGFzc2ljYWwgcmVxdWVzdFxuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IHJlcyBUaGUgcmVzcG9uc2UgdG8gc2VuZFxuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IG5leHRcbi8vICAgICAqIEByZXR1cm4ge3N0cmluZ30gdmFsIFRoZSBjb21wdXRlZCBqc29uIHZhbHVlXG4vLyAgICAgKi9cbi8vICAgICBfaGFuZGxlSHR0cEdldChyZXEsIHJlcywgbmV4dCkge1xuLy8gICAgICAgY28oZnVuY3Rpb24qKCkge1xuLy8gICAgICAgICAgICAgbGV0IHBhdGggPSByZXEucGF0aC5zbGljZSh0aGlzLl9wcmVmaXgubGVuZ3RoIC0gMSk7IC8vIGtlZXAgdGhlIGxlYWRpbmcgc2xhc2hcbi8vICAgICAgICAgICAgIGxldCBrZXkgPSB0aGlzLl9zdG9yZVJvdXRlci5tYXRjaChwYXRoKTtcbi8vICAgICAgICAgICAgIF8uZGV2KCgpID0+IHtcbi8vICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCc8PDwgZmV0Y2gnLCBwYXRoKTtcbi8vICAgICAgICAgICAgIH0pO1xuLy8gICAgICAgICAgICAgcmV0dXJuIHlpZWxkIHRoaXMuZ2V0U3RvcmUoa2V5KTtcbi8vICAgICAgICAgICB9KS5jYWxsKHRoaXMsIChlcnIsIHZhbCkgPT4ge1xuLy8gICAgICAgICAgICAgaWYoZXJyKSB7XG4vLyAgICAgICAgICAgICAgIGlmKFIuRGVidWcuaXNEZXYoKSkge1xuLy8gICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycjogZXJyLnRvU3RyaW5nKCksIHN0YWNrOiBlcnIuc3RhY2sgfSk7XG4vLyAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyOiBlcnIudG9TdHJpbmcoKSB9KTtcbi8vICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgZWxzZSB7XG4vLyAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih2YWwpO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICAgIH0pO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAvKipcbi8vICAgICAqIEBtZXRob2QgX2hhbmRsZUh0dHBQb3N0XG4vLyAgICAgKiBAcGFyYW0ge29iamVjdH0gcmVxIFRoZSBjbGFzc2ljYWwgcmVxdWVzdFxuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IHJlcyBUaGUgcmVzcG9uc2UgdG8gc2VuZFxuLy8gICAgICogQHJldHVybiB7c3RyaW5nfSBzdHJcbi8vICAgICAqL1xuLy8gICAgIF9oYW5kbGVIdHRwUG9zdChyZXEsIHJlcykge1xuLy8gICAgICAgY28oZnVuY3Rpb24qKCkge1xuLy8gICAgICAgICAgICAgbGV0IHBhdGggPSByZXEucGF0aC5zbGljZSh0aGlzLl9wcmVmaXgubGVuZ3RoIC0gMSk7IC8vIGtlZXAgdGhlIGxlYWRpbmcgc2xhc2hcbi8vICAgICAgICAgICAgIGxldCBoYW5kbGVyID0gdGhpcy5fYWN0aW9uc1JvdXRlci5tYXRjaChwYXRoKTtcbi8vICAgICAgICAgICAgIF8uZGV2KCgpID0+XG4vLyAgICAgICAgICAgICAgIHJlcS5ib2R5LnNob3VsZC5iZS5hbi5PYmplY3QgJiZcbi8vICAgICAgICAgICAgICAgcmVxLmJvZHkuZ3VpZC5zaG91bGQuYmUuYS5TdHJpbmcgJiZcbi8vICAgICAgICAgICAgICAgcmVxLmJvZHkucGFyYW1zLnNob3VsZC5iZS5vayAmJiBfLmlzUGxhaW5PYmplY3QocmVxLmJvZHkucGFyYW1zKVxuLy8gICAgICAgICAgICAgICApO1xuLy8gICAgICAgICAgICAgaWYoIV8uaGFzKHRoaXMuX3Nlc3Npb25zLCByZXEuYm9keS5ndWlkKSkge1xuLy8gICAgICAgICAgICAgICB0aGlzLl9zZXNzaW9uc1tndWlkXSA9IG5ldyBTZXNzaW9uKGd1aWQsIHRoaXMuX3N0b3JlRXZlbnRzLCB0aGlzLl9ldmVudHNFdmVudHMsIHRoaXMuX3Nlc3Npb25zRXZlbnRzLCB0aGlzLnNlc3Npb25UaW1lb3V0KTtcbi8vICAgICAgICAgICAgICAgeWllbGQgdGhpcy5zZXNzaW9uQ3JlYXRlZChndWlkKTtcbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIGxldCBwYXJhbXMgPSBfLmV4dGVuZCh7fSwgeyBndWlkOiByZXEuYm9keS5ndWlkIH0sIHJlcS5ib2R5LnBhcmFtcyk7XG4vLyAgICAgICAgICAgICBfLmRldigoKSA9PiB7XG4vLyAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignPDw8IGFjdGlvbicsIHBhdGgsIHBhcmFtcyk7XG4vLyAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgIHJldHVybiB5aWVsZCBoYW5kbGVyKHBhcmFtcyk7XG4vLyAgICAgICAgICAgfSkuY2FsbCh0aGlzLCAoZXJyLCB2YWwpID0+IHtcbi8vICAgICAgICAgICAgIGlmKGVycikge1xuLy8gICAgICAgICAgICAgICBpZihSLkRlYnVnLmlzRGV2KCkpIHtcbi8vICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnI6IGVyci50b1N0cmluZygpLCBzdGFjazogZXJyLnN0YWNrIH0pO1xuLy8gICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgIGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycjogZXJyLnRvU3RyaW5nKCkgfSk7XG4vLyAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIGVsc2Uge1xuLy8gICAgICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih2YWwpO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICAgIH0pO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAvKipcbi8vICAgICAqIDxwPiBDcmVhdGUgYSBSLlNpbXBsZVVwbGlua1NlcnZlci5Db25uZWN0aW9uIGluIG9yZGVyIHRvIHNldCB1cCBoYW5kbGVyIGl0ZW1zLiA8YnIgLz5cbi8vICAgICAqIFRyaWdnZXJlZCB3aGVuIGEgc29ja2V0IGNvbm5lY3Rpb24gaXMgZXN0YWJsaXNoZWQgPC9wPlxuLy8gICAgICogQG1ldGhvZCBfaGFuZGxlU29ja2V0Q29ubmVjdGlvblxuLy8gICAgICogQHBhcmFtIHtPYmplY3R9IHNvY2tldCBUaGUgc29ja2V0IHVzZWQgaW4gdGhlIGNvbm5lY3Rpb25cbi8vICAgICAqL1xuLy8gICAgIF9oYW5kbGVTb2NrZXRDb25uZWN0aW9uKHNvY2tldCkge1xuLy8gICAgICAgbGV0IGNvbm5lY3Rpb24gPSBuZXcgQ29ubmVjdGlvbih0aGlzLl9waWQsIHNvY2tldCwgdGhpcy5faGFuZGxlU29ja2V0RGlzY29ubmVjdGlvbiwgdGhpcy5fbGlua1Nlc3Npb24sIHRoaXMuX3VubGlua1Nlc3Npb24pO1xuLy8gICAgICAgdGhpcy5fY29ubmVjdGlvbnNbY29ubmVjdGlvbi51bmlxdWVJZF0gPSBjb25uZWN0aW9uO1xuLy8gICAgIH1cblxuLy8gICAgIC8qKlxuLy8gICAgICogPHA+IERlc3Ryb3kgYSBSLlNpbXBsZVVwbGlua1NlcnZlci5Db25uZWN0aW9uLiA8YnIgLz5cbi8vICAgICAqIFRyaWdnZXJlZCB3aGVuIGEgc29ja2V0IGNvbm5lY3Rpb24gaXMgY2xvc2VkIDwvcD5cbi8vICAgICAqIEBtZXRob2QgX2hhbmRsZVNvY2tldERpc2Nvbm5lY3Rpb25cbi8vICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1bmlxdWVJZCBUaGUgdW5pcXVlIElkIG9mIHRoZSBjb25uZWN0aW9uXG4vLyAgICAgKi9cbi8vICAgICBfaGFuZGxlU29ja2V0RGlzY29ubmVjdGlvbih1bmlxdWVJZCkge1xuLy8gICAgICAgbGV0IGd1aWQgPSB0aGlzLl9jb25uZWN0aW9uc1t1bmlxdWVJZF0uZ3VpZDtcbi8vICAgICAgIGlmKGd1aWQgJiYgdGhpcy5fc2Vzc2lvbnNbZ3VpZF0pIHtcbi8vICAgICAgICAgdGhpcy5fc2Vzc2lvbnNbZ3VpZF0uZGV0YWNoQ29ubmVjdGlvbigpO1xuLy8gICAgICAgfVxuLy8gICAgICAgZGVsZXRlIHRoaXMuX2Nvbm5lY3Rpb25zW3VuaXF1ZUlkXTtcbi8vICAgICB9XG5cbi8vICAgICAvKipcbi8vICAgICAqIDxwPkxpbmsgYSBTZXNzaW9uIGluIG9yZGVyIHRvIHNldCB1cCBzdWJzY3JpYmluZyBhbmQgdW5zdWJzY3JpYmluZyBtZXRob2RzIHVwbGluay1zZXJ2ZXItc2lkZTwvcD5cbi8vICAgICAqIEBtZXRob2QgX2xpbmtTZXNzaW9uXG4vLyAgICAgKiBAcGFyYW0ge1NpbXBsZVVwbGlua1NlcnZlci5Db25uZWN0aW9ufSBjb25uZWN0aW9uIFRoZSBjcmVhdGVkIGNvbm5lY3Rpb25cbi8vICAgICAqIEBwYXJhbSB7c3RyaW5nfSBndWlkIFVuaXF1ZSBzdHJpbmcgR1VJRFxuLy8gICAgICogQHJldHVybiB7b2JqZWN0fSB0aGUgb2JqZWN0IHRoYXQgY29udGFpbnMgbWV0aG9kcyBzdWJzY3JpcHRpb25zL3Vuc3Vic2NyaXB0aW9uc1xuLy8gICAgICovXG4vLyAgICAgX2xpbmtTZXNzaW9uKGNvbm5lY3Rpb24sIGd1aWQpIHtcbi8vICAgICAgIHJldHVybiBfLmNvcHJvbWlzZShmdW5jdGlvbiooKSB7XG4vLyAgICAgICAgIGlmKCF0aGlzLl9zZXNzaW9uc1tndWlkXSkge1xuLy8gICAgICAgICAgIHRoaXMuX3Nlc3Npb25zW2d1aWRdID0gbmV3IFNlc3Npb24oZ3VpZCwgdGhpcy5fc3RvcmVFdmVudHMsIHRoaXMuX2V2ZW50c0V2ZW50cywgdGhpcy5fc2Vzc2lvbnNFdmVudHMsIHRoaXMuc2Vzc2lvblRpbWVvdXQpO1xuLy8gICAgICAgICAgIHlpZWxkIHRoaXMuc2Vzc2lvbkNyZWF0ZWQoZ3VpZCk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcmV0dXJuIHRoaXMuX3Nlc3Npb25zW2d1aWRdLmF0dGFjaENvbm5lY3Rpb24oY29ubmVjdGlvbik7XG4vLyAgICAgICB9LHRoaXMpO1xuLy8gICAgIH1cblxuLy8gICAgIC8qKlxuLy8gICAgICogPHA+VW5saW5rIGEgU2Vzc2lvbjwvcD5cbi8vICAgICAqIEBtZXRob2QgX3VubGlua1Nlc3Npb25cbi8vICAgICAqIEBwYXJhbSB7U2ltcGxlVXBsaW5rU2VydmVyLkNvbm5lY3Rpb259IGNvbm5lY3Rpb25cbi8vICAgICAqIEBwYXJhbSB7c3RyaW5nfSBndWlkIFVuaXF1ZSBzdHJpbmcgR1VJRFxuLy8gICAgICogQHJldHVybiB7RnVuY3Rpb259IGZuXG4vLyAgICAgKi9cbi8vICAgICBfdW5saW5rU2Vzc2lvbihjb25uZWN0aW9uLCBndWlkKSB7XG4vLyAgICAgICByZXR1cm4oZm4pID0+IHtcbi8vICAgICAgICAgdHJ5IHtcbi8vICAgICAgICAgICBpZih0aGlzLl9zZXNzaW9uc1tndWlkXSkge1xuLy8gICAgICAgICAgICAgdGhpcy5fc2Vzc2lvbnNbZ3VpZF0udGVybWluYXRlKCk7XG4vLyAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGNhdGNoKGVycikge1xuLy8gICAgICAgICAgIHJldHVybiBmbihSLkRlYnVnLmV4dGVuZEVycm9yKCdSLlNpbXBsZVVwbGlua1NlcnZlckluc3RhbmNlLl91bmxpbmtTZXNzaW9uKC4uLiknKSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcmV0dXJuIGZuKG51bGwpO1xuLy8gICAgICAgfTtcbi8vICAgICB9XG4vLyAgICAgLyoqXG4vLyAgICAgKiBAbWV0aG9kIF9oYW5kbGVTZXNzaW9uRXhwaXJlXG4vLyAgICAgKiBAcGFyYW0ge3N0cmluZ30gZ3VpZCBVbmlxdWUgc3RyaW5nIEdVSURcbi8vICAgICAqL1xuLy8gICAgIF9oYW5kbGVTZXNzaW9uRXhwaXJlKGd1aWQpIHtcbi8vICAgICAgIF8uZGV2KCgpID0+IHRoaXMuX3Nlc3Npb25zLmd1aWQuc2hvdWxkLmJlLm9rKTtcbi8vICAgICAgIGRlbGV0ZSB0aGlzLl9zZXNzaW9uc1tndWlkXTtcbi8vICAgICAgIGNvKGZ1bmN0aW9uKigpIHtcbi8vICAgICAgICAgeWllbGQgdGhpcy5zZXNzaW9uRGVzdHJveWVkKGd1aWQpO1xuLy8gICAgICAgfSkuY2FsbCh0aGlzLCBSLkRlYnVnLnJldGhyb3coJ1IuU2ltcGxlVXBsaW5rU2VydmVyLl9oYW5kbGVTZXNzaW9uRXhwaXJlKC4uLiknKSk7XG4vLyAgICAgfVxuXG4vLyAgIH1cblxuLy8gICBfLmV4dGVuZChVcGxpbmtTaW1wbGVTZXJ2ZXIucHJvdG90eXBlLCAvKiogQGxlbmRzIFIuVXBsaW5rLnByb3RvdHlwZSAqLyB7XG4vLyAgICAgX3NwZWNzOiBudWxsLFxuLy8gICAgIF9waWQ6IG51bGwsXG4vLyAgICAgX3ByZWZpeDogbnVsbCxcbi8vICAgICBfYXBwOiBudWxsLFxuLy8gICAgIF9pbzogbnVsbCxcbi8vICAgICBfc3RvcmU6IG51bGwsXG4vLyAgICAgX2hhc2hlczogbnVsbCxcbi8vICAgICBfc3RvcmVFdmVudHM6IG51bGwsXG4vLyAgICAgX3N0b3JlUm91dGVyOiBudWxsLFxuLy8gICAgIF9ldmVudHNSb3V0ZXI6IG51bGwsXG4vLyAgICAgX2V2ZW50c0V2ZW50czogbnVsbCxcbi8vICAgICBfYWN0aW9uc1JvdXRlcjogbnVsbCxcbi8vICAgICBfc2Vzc2lvbnM6IG51bGwsXG4vLyAgICAgX3Nlc3Npb25zRXZlbnRzOiBudWxsLFxuLy8gICAgIF9jb25uZWN0aW9uczogbnVsbCxcbi8vICAgICBib290c3RyYXA6IG51bGwsXG4vLyAgICAgc2Vzc2lvbkNyZWF0ZWQ6IG51bGwsXG4vLyAgICAgc2Vzc2lvbkRlc3Ryb3llZDogbnVsbCxcbi8vICAgICBzZXNzaW9uVGltZW91dDogbnVsbCxcbi8vICAgfSk7XG5cblxuXG5cbi8vICAgICAqXG4vLyAgICAgKiA8cD5TZXR0aW5nIHVwIGEgY29ubmVjdGlvbiBpbiBvcmRlciB0byBpbml0aWFsaWVzIG1ldGhvZHMgYW5kIHRvIHByb3ZpZGVzIHNwZWNpZmljcyBsaXN0ZW5lcnMgb24gdGhlIHNvY2tldDwvcD5cbi8vICAgICAqIEBtZXRob2QgQ29ubmVjdGlvblxuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IHBpZFxuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IHNvY2tldFxuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IGhhbmRsZVNvY2tldERpc2Nvbm5lY3Rpb25cbi8vICAgICAqIEBwYXJhbSB7b2JqZWN0fSBsaW5rU2Vzc2lvblxuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IHVubGlua1Nlc3Npb25cblxuXG4vLyAgICAgY2xhc3MgQ29ubmVjdGlvbiB7XG4vLyAgICAgICBjb25zdHJ1Y3Rvcih7cGlkLCBzb2NrZXQsIGhhbmRsZVNvY2tldERpc2Nvbm5lY3Rpb24sIGxpbmtTZXNzaW9uLCB1bmxpbmtTZXNzaW9ufSl7XG4vLyAgICAgICAgIHRoaXMuX3BpZCA9IHBpZDtcbi8vICAgICAgICAgdGhpcy51bmlxdWVJZCA9IF8udW5pcXVlSWQoJ1IuU2ltcGxlVXBsaW5rU2VydmVyLkNvbm5lY3Rpb24nKTtcbi8vICAgICAgICAgdGhpcy5fc29ja2V0ID0gc29ja2V0O1xuLy8gICAgICAgICB0aGlzLl9oYW5kbGVTb2NrZXREaXNjb25uZWN0aW9uID0gaGFuZGxlU29ja2V0RGlzY29ubmVjdGlvbjtcbi8vICAgICAgICAgdGhpcy5fbGlua1Nlc3Npb24gPSBsaW5rU2Vzc2lvbjtcbi8vICAgICAgICAgdGhpcy5fdW5saW5rU2Vzc2lvbiA9IHVubGlua1Nlc3Npb247XG4vLyAgICAgICAgIHRoaXMuX2JpbmRIYW5kbGVycygpO1xuLy8gICAgICAgfVxuXG4vLyAgICAgICAvKipcbi8vICAgICAgICogPHA+U2V0dGluZyB1cCB0aGUgc3BlY2lmaWNzIGxpc3RlbmVycyBmb3IgdGhlIHNvY2tldDwvcD5cbi8vICAgICAgICogQG1ldGhvZCBfYmluZEhhbmRsZXJzXG4vLyAgICAgICAqL1xuLy8gICAgICAgX2JpbmRIYW5kbGVycygpIHtcbi8vICAgICAgICAgdGhpcy5fc29ja2V0Lm9uKCdoYW5kc2hha2UnLCBSLnNjb3BlKHRoaXMuX2hhbmRsZUhhbmRzaGFrZSwgdGhpcykpO1xuLy8gICAgICAgICB0aGlzLl9zb2NrZXQub24oJ3N1YnNjcmliZVRvJywgUi5zY29wZSh0aGlzLl9oYW5kbGVTdWJzY3JpYmVUbywgdGhpcykpO1xuLy8gICAgICAgICB0aGlzLl9zb2NrZXQub24oJ3Vuc3Vic2NyaWJlRnJvbScsIFIuc2NvcGUodGhpcy5faGFuZGxlVW5zdWJzY3JpYmVGcm9tLCB0aGlzKSk7XG4vLyAgICAgICAgIHRoaXMuX3NvY2tldC5vbignbGlzdGVuVG8nLCBSLnNjb3BlKHRoaXMuX2hhbmRsZUxpc3RlblRvLCB0aGlzKSk7XG4vLyAgICAgICAgIHRoaXMuX3NvY2tldC5vbigndW5saXN0ZW5Gcm9tJywgUi5zY29wZSh0aGlzLl9oYW5kbGVVbmxpc3RlbkZyb20sIHRoaXMpKTtcbi8vICAgICAgICAgdGhpcy5fc29ja2V0Lm9uKCdkaXNjb25uZWN0JywgUi5zY29wZSh0aGlzLl9oYW5kbGVEaXNjb25uZWN0LCB0aGlzKSk7XG4vLyAgICAgICAgIHRoaXMuX3NvY2tldC5vbigndW5oYW5kc2hha2UnLCBSLnNjb3BlKHRoaXMuX2hhbmRsZVVuSGFuZHNoYWtlLCB0aGlzKSk7XG4vLyAgICAgICB9XG5cbi8vICAgICAgIC8qKlxuLy8gICAgICAgKiA8cD4gU2ltcGx5IGVtaXQgYSBzcGVjaWZpYyBhY3Rpb24gb24gdGhlIHNvY2tldCA8L3A+XG4vLyAgICAgICAqIEBtZXRob2QgZW1pdFxuLy8gICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgYWN0aW9uIHRvIHNlbmRcbi8vICAgICAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtcyBUaGUgcGFyYW1zXG4vLyAgICAgICAqL1xuLy8gICAgICAgZW1pdChuYW1lLCBwYXJhbXMpIHtcbi8vICAgICAgICAgXy5kZXYoKCkgPT4ge1xuLy8gICAgICAgICAgIGNvbnNvbGUud2FybignW0NdID4+PiAnICsgbmFtZSwgcGFyYW1zKTtcbi8vICAgICAgICAgfSk7XG4vLyAgICAgICAgIHRoaXMuX3NvY2tldC5lbWl0KG5hbWUsIHBhcmFtcyk7XG4vLyAgICAgICB9XG5cbi8vICAgICAgIC8qKlxuLy8gICAgICAgKiA8cD4gVHJpZ2dlcmVkIGJ5IHRoZSByZWNlbnRseSBjb25uZWN0ZWQgY2xpZW50LiA8YnIgLz5cbi8vICAgICAgICogQ29tYmluZXMgbWV0aG9kcyBvZiBzdWJzY3JpcHRpb25zIHRoYXQgd2lsbCBiZSB0cmlnZ2VyZWQgYnkgdGhlIGNsaWVudCB2aWEgc29ja2V0IGxpc3RlbmluZzwvcD5cbi8vICAgICAgICogQG1ldGhvZCBfaGFuZGxlSGFuZHNoYWtlXG4vLyAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXJhbXMgQ29udGFpbnMgdGhlIHVuaXF1ZSBzdHJpbmcgR1VJRFxuLy8gICAgICAgKi9cbi8vICAgICAgIF9oYW5kbGVIYW5kc2hha2UocGFyYW1zKSB7XG4vLyAgICAgICAgIGlmKCFwYXJhbXMuZ3VpZC5zaG91bGQuYmUub2sgfHwgIXBhcmFtcy5ndWlkLnNob3VsZC5iZS5hLlN0cmluZykge1xuLy8gICAgICAgICAgIHRoaXMuZW1pdCgnZXJyJywgeyBlcnI6ICdoYW5kc2hha2UucGFyYW1zLmd1aWQ6IGV4cGVjdGVkIFN0cmluZy4nfSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgZWxzZSBpZih0aGlzLmd1aWQpIHtcbi8vICAgICAgICAgICB0aGlzLmVtaXQoJ2VycicsIHsgZXJyOiAnaGFuZHNoYWtlOiBzZXNzaW9uIGFscmVhZHkgbGlua2VkLid9KTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBlbHNlIHtcbi8vICAgICAgICAgICBjbyhmdW5jdGlvbiooKSB7XG4vLyAgICAgICAgICAgICB0aGlzLmd1aWQgPSBwYXJhbXMuZ3VpZDtcbi8vICAgICAgICAgICAgIGxldCBzID0geWllbGQgdGhpcy5fbGlua1Nlc3Npb24odGhpcywgdGhpcy5ndWlkKTtcbi8vICAgICAgICAgICAgIHRoaXMuZW1pdCgnaGFuZHNoYWtlLWFjaycsIHtcbi8vICAgICAgICAgICAgICAgcGlkOiB0aGlzLl9waWQsXG4vLyAgICAgICAgICAgICAgIHJlY292ZXJlZDogcy5yZWNvdmVyZWQsXG4vLyAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgIHRoaXMuX3N1YnNjcmliZVRvID0gcy5zdWJzY3JpYmVUbztcbi8vICAgICAgICAgICAgIHRoaXMuX3Vuc3Vic2NyaWJlRnJvbSA9IHMudW5zdWJzY3JpYmVGcm9tO1xuLy8gICAgICAgICAgICAgdGhpcy5fbGlzdGVuVG8gPSBzLmxpc3RlblRvO1xuLy8gICAgICAgICAgICAgdGhpcy5fdW5saXN0ZW5Gcm9tID0gcy51bmxpc3RlbkZyb207XG4vLyAgICAgICAgICAgfSkuY2FsbCh0aGlzLCBSLkRlYnVnLnJldGhyb3coJ1IuU2ltcGxlVXBsaW5rU2VydmVyLkNvbm5lY3Rpb24uX2hhbmRsZUhhbmRzaGFrZSguLi4pJykpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICB9XG5cbi8vICAgICAgIC8qKlxuLy8gICAgICAgKiA8cD4gVHJpZ2dlcmVkIGJ5IHRoZSByZWNlbnRseSBkaXNjb25uZWN0ZWQgY2xpZW50LiA8YnIgLz5cbi8vICAgICAgICogUmVtb3ZlcyBtZXRob2RzIG9mIHN1YnNjcmlwdGlvbnM8L3A+XG4vLyAgICAgICAqIEBtZXRob2QgX2hhbmRsZUhhbmRzaGFrZVxuLy8gICAgICAgKi9cbi8vICAgICAgIF9oYW5kbGVVbkhhbmRzaGFrZSgpIHtcbi8vICAgICAgICAgaWYoIXRoaXMuZ3VpZCkge1xuLy8gICAgICAgICAgIHRoaXMuZW1pdCgnZXJyJywgeyBlcnI6ICd1bmhhbmRzaGFrZTogbm8gYWN0aXZlIHNlc3Npb24uJ30pO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGVsc2Uge1xuLy8gICAgICAgICAgIGNvKGZ1bmN0aW9uKigpIHtcbi8vICAgICAgICAgICAgIHRoaXMuX3N1YnNjcmliZVRvID0gbnVsbDtcbi8vICAgICAgICAgICAgIHRoaXMuX3Vuc3Vic2NyaWJlRnJvbSA9IG51bGw7XG4vLyAgICAgICAgICAgICB0aGlzLl9saXN0ZW5UbyA9IG51bGw7XG4vLyAgICAgICAgICAgICB0aGlzLl91bmxpc3RlbkZyb20gPSBudWxsO1xuLy8gICAgICAgICAgICAgbGV0IHMgPSB5aWVsZCB0aGlzLl91bmxpbmtTZXNzaW9uKHRoaXMsIHRoaXMuZ3VpZCk7XG4vLyAgICAgICAgICAgICB0aGlzLmVtaXQoJ3VuaGFuZHNoYWtlLWFjaycpO1xuLy8gICAgICAgICAgICAgdGhpcy5ndWlkID0gbnVsbDtcbi8vICAgICAgICAgICB9KS5jYWxsKHRoaXMsIFIuRGVidWcucmV0aHJvdygnUi5TaW1wbGVVcGxpbmtTZXJ2ZXIuQ29ubmVjdGlvbi5faGFuZGxlVW5IYW5kc2hha2UoLi4uKScpKTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgfVxuXG4vLyAgICAgICAvKipcbi8vICAgICAgICogPHA+TWFwcyB0aGUgdHJpZ2dlcmVkIGV2ZW50IHdpdGggdGhlIF9zdWJzY3JpYmVUbyBtZXRob2RzIDwvcD5cbi8vICAgICAgICogQG1ldGhvZCBfaGFuZGxlU3Vic2NyaWJlVG9cbi8vICAgICAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtcyBDb250YWlucyB0aGUga2V5IHByb3ZpZGVkIGJ5IGNsaWVudFxuLy8gICAgICAgKi9cbi8vICAgICAgIF9oYW5kbGVTdWJzY3JpYmVUbyhwYXJhbXMpIHtcbi8vICAgICAgICAgaWYoIXBhcmFtcy5rZXkuc2hvdWxkLmJlLm9rIHx8ICFwYXJhbXMua2V5LnNob3VsZC5iZS5hLlN0cmluZykge1xuLy8gICAgICAgICAgIHRoaXMuZW1pdCgnZXJyJywgeyBlcnI6ICdzdWJzY3JpYmVUby5wYXJhbXMua2V5OiBleHBlY3RlZCBTdHJpbmcuJyB9KTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBlbHNlIGlmKCF0aGlzLl9zdWJzY3JpYmVUbykge1xuLy8gICAgICAgICAgIHRoaXMuZW1pdCgnZXJyJywgeyBlcnI6ICdzdWJzY3JpYmVUbzogcmVxdWlyZXMgaGFuZHNoYWtlLicgfSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgZWxzZSB7XG4vLyAgICAgICAgICAgdGhpcy5fc3Vic2NyaWJlVG8ocGFyYW1zLmtleSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgIH1cblxuLy8gICAgICAgLyoqXG4vLyAgICAgICAqIDxwPk1hcHMgdGhlIHRyaWdnZXJlZCBldmVudCB3aXRoIHRoZSBfdW5zdWJzY3JpYmVGcm9tIG1ldGhvZHM8L3A+XG4vLyAgICAgICAqIEBtZXRob2QgX2hhbmRsZVVuc3Vic2NyaWJlRnJvbVxuLy8gICAgICAgKiBAcGFyYW0ge29iamVjdH0gcGFyYW1zIENvbnRhaW5zIHRoZSBrZXkgcHJvdmlkZWQgYnkgY2xpZW50XG4vLyAgICAgICAqL1xuLy8gICAgICAgX2hhbmRsZVVuc3Vic2NyaWJlRnJvbShwYXJhbXMpIHtcbi8vICAgICAgICAgaWYoIXBhcmFtcy5rZXkuc2hvdWxkLmJlLm9rIHx8ICFwYXJhbXMua2V5LnNob3VsZC5iZS5hLlN0cmluZykge1xuLy8gICAgICAgICAgIHRoaXMuZW1pdCgnZXJyJywgeyBlcnI6ICd1bnN1YnNjcmliZUZyb20ucGFyYW1zLmtleTogZXhwZWN0ZWQgU3RyaW5nLicgfSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgZWxzZSBpZighdGhpcy5fdW5zdWJzY3JpYmVGcm9tKSB7XG4vLyAgICAgICAgICAgdGhpcy5lbWl0KCdlcnInLCB7IGVycjogJ3Vuc3Vic2NyaWJlRnJvbTogcmVxdWlyZXMgaGFuZHNoYWtlLicgfSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgZWxzZSB7XG4vLyAgICAgICAgICAgdGhpcy5fdW5zdWJzY3JpYmVGcm9tKHBhcmFtcy5rZXkpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICB9XG5cbi8vICAgICAgIC8qKlxuLy8gICAgICAgKiA8cD5NYXBzIHRoZSB0cmlnZ2VyZWQgZXZlbnQgd2l0aCB0aGUgbGlzdGVuVG8gbWV0aG9kczwvcD5cbi8vICAgICAgICogQG1ldGhvZCBfaGFuZGxlTGlzdGVuVG9cbi8vICAgICAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtcyBDb250YWlucyB0aGUgZXZlbnROYW1lIHByb3ZpZGVkIGJ5IGNsaWVudFxuLy8gICAgICAgKi9cbi8vICAgICAgIF9oYW5kbGVMaXN0ZW5UbyhwYXJhbXMpIHtcbi8vICAgICAgICAgaWYoIXBhcmFtcy5ldmVudE5hbWUuc2hvdWxkLmJlLm9rIHx8ICFwYXJhbXMuZXZlbnROYW1lLnNob3VsZC5iZS5hLlN0cmluZykge1xuLy8gICAgICAgICAgIHRoaXMuZW1pdCgnZXJyJywgeyBlcnI6ICdsaXN0ZW5Uby5wYXJhbXMuZXZlbnROYW1lOiBleHBlY3RlZCBTdHJpbmcuJyB9KTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICBlbHNlIGlmKCF0aGlzLl9saXN0ZW5Ubykge1xuLy8gICAgICAgICAgIHRoaXMuZW1pdCgnZXJyJywgeyBlcnI6ICdsaXN0ZW5UbzogcmVxdWlyZXMgaGFuZHNoYWtlLicgfSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgZWxzZSB7XG4vLyAgICAgICAgICAgdGhpcy5saXN0ZW5UbyhwYXJhbXMuZXZlbnROYW1lKTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgfVxuXG4vLyAgICAgICAvKipcbi8vICAgICAgICogPHA+TWFwcyB0aGUgdHJpZ2dlcmVkIGV2ZW50IHdpdGggdGhlIHVubGlzdGVuRnJvbSBtZXRob2RzPC9wPlxuLy8gICAgICAgKiBAbWV0aG9kIF9oYW5kbGVVbmxpc3RlbkZyb21cbi8vICAgICAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtcyBDb250YWlucyB0aGUgZXZlbnROYW1lIHByb3ZpZGVkIGJ5IGNsaWVudFxuLy8gICAgICAgKi9cbi8vICAgICAgIF9oYW5kbGVVbmxpc3RlbkZyb20ocGFyYW1zKSB7XG4vLyAgICAgICAgIGlmKCFwYXJhbXMuZXZlbnROYW1lLnNob3VsZC5iZS5vayB8fCAhcGFyYW1zLmV2ZW50TmFtZS5zaG91bGQuYmUuYS5TdHJpbmcpIHtcbi8vICAgICAgICAgICB0aGlzLmVtaXQoJ2VycicsIHsgZXJyOiAndW5saXN0ZW5Gcm9tLnBhcmFtcy5ldmVudE5hbWU6IGV4cGVjdGVkIFN0cmluZy4nIH0pO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGVsc2UgaWYoIXRoaXMudW5saXN0ZW5Gcm9tKSB7XG4vLyAgICAgICAgICAgdGhpcy5fZW1pdCgnZXJyJywgeyBlcnI6ICd1bmxpc3RlbkZyb206IHJlcXVpcmVzIGhhbmRzaGFrZS4nIH0pO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGVsc2Uge1xuLy8gICAgICAgICAgIHRoaXMudW5saXN0ZW5Gcm9tKHBhcmFtcy5ldmVudE5hbWUpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICB9XG5cbi8vICAgICAgICAvKipcbi8vICAgICAgICAqIDxwPlRyaWdnZXJlZCBieSB0aGUgcmVjZW50bHkgZGlzY29ubmVjdGVkIGNsaWVudC48L3A+XG4vLyAgICAgICAgKiBAbWV0aG9kIF9oYW5kbGVEaXNjb25uZWN0XG4vLyAgICAgICAgKi9cbi8vICAgICAgIF9oYW5kbGVEaXNjb25uZWN0KCkge1xuLy8gICAgICAgICB0aGlzLl9oYW5kbGVTb2NrZXREaXNjb25uZWN0aW9uKHRoaXMudW5pcXVlSWQsIGZhbHNlKTtcbi8vICAgICAgIH1cbi8vICAgICB9XG5cbi8vICAgICAgIF8uZXh0ZW5kKENvbm5lY3Rpb24ucHJvdG90eXBlLCAvKiogQGxlbmRzIFIuVXBsaW5rLnByb3RvdHlwZSAqLyB7XG4vLyAgICAgICAgIF9zb2NrZXQ6IG51bGwsXG4vLyAgICAgICAgIF9waWQ6IG51bGwsXG4vLyAgICAgICAgIHVuaXF1ZUlkOiBudWxsLFxuLy8gICAgICAgICBndWlkOiBudWxsLFxuLy8gICAgICAgICBfaGFuZGxlU29ja2V0RGlzY29ubmVjdGlvbjogbnVsbCxcbi8vICAgICAgICAgX2xpbmtTZXNzaW9uOiBudWxsLFxuLy8gICAgICAgICBfdW5saW5rU2Vzc2lvbjogbnVsbCxcbi8vICAgICAgICAgX3N1YnNjcmliZVRvOiBudWxsLFxuLy8gICAgICAgICBfdW5zdWJzY3JpYmVGcm9tOiBudWxsLFxuLy8gICAgICAgICBfbGlzdGVuVG86IG51bGwsXG4vLyAgICAgICAgIF91bmxpc3RlbkZyb206IG51bGwsXG4vLyAgICAgICAgIF9kaXNjb25uZWN0ZWQ6IG51bGwsXG4vLyAgICAgICB9KTtcblxuLy8gICAgIC8qKlxuLy8gICAgICogPHA+U2V0dGluZyB1cCBhIHNlc3Npb248L3A+XG4vLyAgICAgKiBAbWV0aG9kIFNlc3Npb25cbi8vICAgICAqIEBwYXJhbSB7b2JqZWN0fSBwaWRcbi8vICAgICAqIEBwYXJhbSB7b2JqZWN0fSBzdG9yZUV2ZW50c1xuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IGV2ZW50c0V2ZW50c1xuLy8gICAgICogQHBhcmFtIHtvYmplY3R9IHNlc3Npb25zRXZlbnRzXG4vLyAgICAgKiBAcGFyYW0ge29iamVjdH0gdGltZW91dFxuLy8gICAgICovXG4vLyAgICAgY2xhc3MgU2Vzc2lvbiB7XG4vLyAgICAgICBjb25zdHJ1Y3Rvcih7Z3VpZCwgc3RvcmVFdmVudHMsIGV2ZW50c0V2ZW50cywgc2Vzc2lvbnNFdmVudHMsIHRpbWVvdXR9KSB7XG4vLyAgICAgICAgIHRoaXMuX2d1aWQgPSBndWlkO1xuLy8gICAgICAgICB0aGlzLl9zdG9yZUV2ZW50cyA9IHN0b3JlRXZlbnRzO1xuLy8gICAgICAgICB0aGlzLl9ldmVudHNFdmVudHMgPSBldmVudHNFdmVudHM7XG4vLyAgICAgICAgIHRoaXMuX3Nlc3Npb25zRXZlbnRzID0gc2Vzc2lvbnNFdmVudHM7XG4vLyAgICAgICAgIHRoaXMuX21lc3NhZ2VRdWV1ZSA9IFtdO1xuLy8gICAgICAgICB0aGlzLl90aW1lb3V0RHVyYXRpb24gPSB0aW1lb3V0O1xuLy8gICAgICAgICB0aGlzLl9leHBpcmUgPSBSLnNjb3BlKHRoaXMuX2V4cGlyZSwgdGhpcyk7XG4vLyAgICAgICAgIHRoaXMuX2V4cGlyZVRpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMuX2V4cGlyZSwgdGhpcy5fdGltZW91dER1cmF0aW9uKTtcbi8vICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9ucyA9IHt9O1xuLy8gICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTtcbi8vICAgICAgIH1cblxuLy8gICAgICAgICAvKipcbi8vICAgICAgICAgKiA8cD5CaW5kIHRoZSBzdWJzY3JpYmluZyBhbmQgdW5zdWJzY3JpYmluZyBtZXRob2RzIHdoZW4gYSBjb25uZWN0aW9uIGlzIGVzdGFibGlzaGVkIDxiciAvPlxuLy8gICAgICAgICAqIE1ldGhvZHMgdGhhdCB0cmlnZ2VyIG9uIGNsaWVudCBpc3N1ZXMgKGxpa2UgZW1pdChcInN1YnNjcmliZVRvXCIpLCBlbWl0KFwidW5zdWJzY3JpYmVGcm9tXCIpKTwvcD5cbi8vICAgICAgICAgKiBAbWV0aG9kIGF0dGFjaENvbm5lY3Rpb25cbi8vICAgICAgICAgKiBAcGFyYW0ge1NpbXBsZVVwbGlua1NlcnZlci5Db25uZWN0aW9ufSBjb25uZWN0aW9uIHRoZSBjdXJyZW50IGNyZWF0ZWQgY29ubmVjdGlvblxuLy8gICAgICAgICAqIEByZXR1cm4ge29iamVjdH0gdGhlIGJpbmRlZCBvYmplY3Qgd2l0aCBtZXRob2RzXG4vLyAgICAgICAgICovXG4vLyAgICAgICAgIGF0dGFjaENvbm5lY3Rpb24oY29ubmVjdGlvbikge1xuLy8gICAgICAgICAgIGxldCByZWNvdmVyZWQgPSAodGhpcy5fY29ubmVjdGlvbiAhPT0gbnVsbCk7XG4vLyAgICAgICAgICAgdGhpcy5kZXRhY2hDb25uZWN0aW9uKCk7XG4vLyAgICAgICAgICAgdGhpcy5fY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XG4vLyAgICAgICAgICAgXy5lYWNoKHRoaXMuX21lc3NhZ2VRdWV1ZSwgZnVuY3Rpb24obSkge1xuLy8gICAgICAgICAgICAgY29ubmVjdGlvbi5lbWl0KG0ubmFtZSwgbS5wYXJhbXMpO1xuLy8gICAgICAgICAgIH0pO1xuLy8gICAgICAgICAgIHRoaXMuX21lc3NhZ2VRdWV1ZSA9IG51bGw7XG4vLyAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2V4cGlyZVRpbWVvdXQpO1xuLy8gICAgICAgICAgIHJldHVybiB7XG4vLyAgICAgICAgICAgICByZWNvdmVyZWQ6IHJlY292ZXJlZCxcbi8vICAgICAgICAgICAgIHN1YnNjcmliZVRvOiBSLnNjb3BlKHRoaXMuc3Vic2NyaWJlVG8sIHRoaXMpLFxuLy8gICAgICAgICAgICAgdW5zdWJzY3JpYmVGcm9tOiBSLnNjb3BlKHRoaXMudW5zdWJzY3JpYmVGcm9tLCB0aGlzKSxcbi8vICAgICAgICAgICAgIGxpc3RlblRvOiBSLnNjb3BlKHRoaXMubGlzdGVuVG8sIHRoaXMpLFxuLy8gICAgICAgICAgICAgdW5saXN0ZW5Gcm9tOiBSLnNjb3BlKHRoaXMudW5saXN0ZW5Gcm9tLCB0aGlzKSxcbi8vICAgICAgICAgICB9O1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgLyoqXG4vLyAgICAgICAgICogPHA+UmVtb3ZlIHRoZSBwcmV2aW91c2x5IGFkZGVkIGNvbm5lY3Rpb24sIGFuZCBjbGVhbiB0aGUgbWVzc2FnZSBxdWV1ZSA8L3A+XG4vLyAgICAgICAgICogQG1ldGhvZCBkZXRhY2hDb25uZWN0aW9uXG4vLyAgICAgICAgICovXG4vLyAgICAgICAgIGRldGFjaENvbm5lY3Rpb24oKSB7XG4vLyAgICAgICAgICAgaWYodGhpcy5fY29ubmVjdGlvbiA9PT0gbnVsbCkge1xuLy8gICAgICAgICAgICAgcmV0dXJuO1xuLy8gICAgICAgICAgIH1cbi8vICAgICAgICAgICBlbHNlIHtcbi8vICAgICAgICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24gPSBudWxsO1xuLy8gICAgICAgICAgICAgdGhpcy5fbWVzc2FnZVF1ZXVlID0gW107XG4vLyAgICAgICAgICAgICB0aGlzLl9leHBpcmVUaW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLl9leHBpcmUsIHRoaXMuX3RpbWVvdXREdXJhdGlvbik7XG4vLyAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgLyoqXG4vLyAgICAgICAgICogQG1ldGhvZCB0ZXJtaW5hdGVcbi8vICAgICAgICAgKi9cbi8vICAgICAgICAgdGVybWluYXRlKCkge1xuLy8gICAgICAgICAgIHRoaXMuX2V4cGlyZSgpO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgLyoqXG4vLyAgICAgICAgICogPHA+TWV0aG9kIGludm9rZWQgYnkgY2xpZW50IHZpYSBzb2NrZXQgZW1pdCA8YnIgLz5cbi8vICAgICAgICAgKiBTdG9yZSB0aGUgX3NpZ25hbFVwZGF0ZSBtZXRob2QgaW4gc3Vic2NyaXB0aW9uIDxiciAvPlxuLy8gICAgICAgICAqIEFkZCBhIGxpc3RlbmVyIHRoYXQgd2lsbCBjYWxsIF9zaWduYWxVcGRhdGUgd2hlbiB0cmlnZ2VyZWQgPC9wPlxuLy8gICAgICAgICAqIEBtZXRob2Qgc3Vic2NyaWJlVG9cbi8vICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgdG8gc3Vic2NyaWJlXG4vLyAgICAgICAgICovXG4vLyAgICAgICAgIHN1YnNjcmliZVRvKGtleSkge1xuLy8gICAgICAgICAgIF8uZGV2KCgpID0+IHRoaXMuX3N1YnNjcmlwdGlvbnMua2V5LnNob3VsZC5iZS5vayk7XG4vLyAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uc1trZXldID0gdGhpcy5fc2lnbmFsVXBkYXRlKCk7XG4vLyAgICAgICAgICAgdGhpcy5fc3RvcmVFdmVudHMuYWRkTGlzdGVuZXIoJ3NldDonICsga2V5LCB0aGlzLl9zdWJzY3JpcHRpb25zW2tleV0pO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgLyoqXG4vLyAgICAgICAgICogPHA+TWV0aG9kIGludm9rZWQgYnkgY2xpZW50IHZpYSBzb2NrZXQgZW1pdCA8YnIgLz5cbi8vICAgICAgICAgKiBSZW1vdmUgYSBsaXN0ZW5lciBhY2NvcmRpbmcgdG8gdGhlIGtleTwvcD5cbi8vICAgICAgICAgKiBAbWV0aG9kIHN1YnNjcmliZVRvXG4vLyAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IHRvIHVuc3Vic2NyaWJlXG4vLyAgICAgICAgICovXG4vLyAgICAgICAgIHV1bnN1YnNjcmliZUZyb20oa2V5KSB7XG4vLyAgICAgICAgICAgXy5kZXYoKCkgPT4gdGhpcy5fc3Vic2NyaXB0aW9ucy5rZXkuc2hvdWxkLmJlLm9rKTtcbi8vICAgICAgICAgICB0aGlzLl9zdG9yZUV2ZW50cy5yZW1vdmVMaXN0ZW5lcignc2V0OicgKyBrZXksIHRoaXMuX3N1YnNjcmlwdGlvbnNba2V5XSk7XG4vLyAgICAgICAgICAgZGVsZXRlIHRoaXMuX3N1YnNjcmlwdGlvbnNba2V5XTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIC8qKlxuLy8gICAgICAgICAqIDxwPiBTaW1wbHkgZW1pdCBhIHNwZWNpZmljIGFjdGlvbiBvbiB0aGUgc29ja2V0IDwvcD5cbi8vICAgICAgICAgKiBAbWV0aG9kIF9lbWl0XG4vLyAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIGFjdGlvbiB0byBzZW5kXG4vLyAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtcyBUaGUgcGFyYW1zXG4vLyAgICAgICAgICovXG4vLyAgICAgICAgIF9lbWl0KG5hbWUsIHBhcmFtcykge1xuLy8gICAgICAgICAgIF8uZGV2KCgpID0+IHtcbi8vICAgICAgICAgICAgIGNvbnNvbGUud2FybignW1NdID4+PiAnICsgbmFtZSwgcGFyYW1zKTtcbi8vICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICBpZih0aGlzLl9jb25uZWN0aW9uICE9PSBudWxsKSB7XG4vLyAgICAgICAgICAgICB0aGlzLl9jb25uZWN0aW9uLmVtaXQobmFtZSwgcGFyYW1zKTtcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgICAgZWxzZSB7XG4vLyAgICAgICAgICAgICB0aGlzLl9tZXNzYWdlUXVldWUucHVzaCh7XG4vLyAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4vLyAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zLFxuLy8gICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgLyoqIDxwPlB1c2ggYW4gdXBkYXRlIGFjdGlvbiBvbiB0aGUgc29ja2V0LiA8YnIgLz5cbi8vICAgICAgICAgKiBUaGUgY2xpZW50IGlzIGxpc3RlbmluZyBvbiB0aGUgYWN0aW9uIFwidXBkYXRlXCIgc29ja2V0IDwvcD5cbi8vICAgICAgICAgKiBAbWV0aG9kIF9zaWduYWxVcGRhdGVcbi8vICAgICAgICAgKi9cbi8vICAgICAgICAgX3NpZ25hbFVwZGF0ZSgpIHtcbi8vICAgICAgICAgICByZXR1cm4gKHBhdGNoKSA9PiB7XG4vLyAgICAgICAgICAgICB0aGlzLl9lbWl0KCd1cGRhdGUnLCBwYXRjaCk7XG4vLyAgICAgICAgICAgfTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIC8qKiA8cD5QdXNoIGFuIGV2ZW50IGFjdGlvbiBvbiB0aGUgc29ja2V0LiA8YnIgLz5cbi8vICAgICAgICAgKiBUaGUgY2xpZW50IGlzIGxpc3RlbmluZyBvbiB0aGUgYWN0aW9uIFwiZXZlbnRcIiBzb2NrZXQgPC9wPlxuLy8gICAgICAgICAqIEBtZXRob2QgX3NpZ25hbEV2ZW50XG4vLyAgICAgICAgICovXG4vLyAgICAgICAgIF9zaWduYWxFdmVudChldmVudE5hbWUpIHtcbi8vICAgICAgICAgICByZXR1cm4gKHBhcmFtcykgPT4ge1xuLy8gICAgICAgICAgICAgdGhpcy5fZW1pdCgnZXZlbnQnLCB7IGV2ZW50TmFtZTogZXZlbnROYW1lLCBwYXJhbXM6IHBhcmFtcyB9KTtcbi8vICAgICAgICAgICB9O1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgICAgLyoqXG4vLyAgICAgICAgICogQG1ldGhvZCBfZXhwaXJlXG4vLyAgICAgICAgICovXG4vLyAgICAgICAgIF9leHBpcmUoKSB7XG4vLyAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5fc3Vic2NyaXB0aW9ucykuZm9yRWFjaChSLnNjb3BlKHRoaXMudW5zdWJzY3JpYmVGcm9tLCB0aGlzKSk7XG4vLyAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5fbGlzdGVuZXJzKS5mb3JFYWNoKFIuc2NvcGUodGhpcy51bmxpc3RlbkZyb20sIHRoaXMpKTtcbi8vICAgICAgICAgICB0aGlzLl9zZXNzaW9uc0V2ZW50cy5lbWl0KCdleHBpcmUnLCB0aGlzLl9ndWlkKTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIC8qKlxuLy8gICAgICAgICAqIDxwPiBDcmVhdGUgYSBsaXN0ZW5lciBmb3IgdGhlIGV2ZW50cyA8L3A+XG4vLyAgICAgICAgICogQG1ldGhvZCBsaXN0ZW5Ub1xuLy8gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudE5hbWUgVGhlIG5hbWUgb2YgdGhlIGV2ZW50IHRoYXQgd2lsbCBiZSByZWdpc3RlcmVkXG4vLyAgICAgICAgICovXG4vLyAgICAgICAgIGxpc3RlblRvKGV2ZW50TmFtZSkge1xuLy8gICAgICAgICAgIF8uZGV2KCgpID0+IHRoaXMuX2xpc3RlbmVycy5rZXkuc2hvdWxkLmJlLm9rKTtcbi8vICAgICAgICAgICB0aGlzLl9saXN0ZW5lcnNbZXZlbnROYW1lXSA9IHRoaXMuX3NpZ25hbEV2ZW50KGV2ZW50TmFtZSk7XG4vLyAgICAgICAgICAgdGhpcy5fZXZlbnRzRXZlbnRzLmFkZExpc3RlbmVyKCdlbWl0OicgKyBldmVudE5hbWUsIHRoaXMuX2xpc3RlbmVyc1tldmVudE5hbWVdKTtcbi8vICAgICAgICAgfVxuXG4vLyAgICAgICAgIC8qKlxuLy8gICAgICAgICAqIDxwPiBSZW1vdmUgYSBsaXN0ZW5lciBmcm9tIHRoZSBldmVudHMgPC9wPlxuLy8gICAgICAgICAqIEBtZXRob2QgdW5saXN0ZW5Gcm9tXG4vLyAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50TmFtZSBUaGUgbmFtZSBvZiB0aGUgZXZlbnQgdGhhdCB3aWxsIGJlIHVucmVnaXN0ZXJlZFxuLy8gICAgICAgICAqL1xuLy8gICAgICAgICB1bmxpc3RlbkZyb20oZXZlbnROYW1lKSB7XG4vLyAgICAgICAgICAgXy5kZXYoKCkgPT4gdGhpcy5fbGlzdGVuZXJzLmV2ZW50TmFtZS5zaG91bGQuYmUub2spO1xuLy8gICAgICAgICAgIHRoaXMuX2V2ZW50c0V2ZW50cy5yZW1vdmVMaXN0ZW5lcignZW1pdDonICsgZXZlbnROYW1lLCB0aGlzLl9saXN0ZW5lcnNbZXZlbnROYW1lXSk7XG4vLyAgICAgICAgICAgZGVsZXRlIHRoaXMuX2xpc3RlbmVyc1tldmVudE5hbWVdO1xuLy8gICAgICAgICB9XG5cbi8vICAgICAgIH1cblxuLy8gICAgICAgXy5leHRlbmQoU2Vzc2lvbi5wcm90b3R5cGUsIC8qKiBAbGVuZHMgUi5VcGxpbmsucHJvdG90eXBlICovIHtcbi8vICAgICAgICAgX2d1aWQ6IG51bGwsXG4vLyAgICAgICAgIF9jb25uZWN0aW9uOiBudWxsLFxuLy8gICAgICAgICBfc3Vic2NyaXB0aW9uczogbnVsbCxcbi8vICAgICAgICAgX2xpc3RlbmVyczogbnVsbCxcbi8vICAgICAgICAgX3N0b3JlRXZlbnRzOiBudWxsLFxuLy8gICAgICAgICBfZXZlbnRzRXZlbnRzOiBudWxsLFxuLy8gICAgICAgICBfc2Vzc2lvbnNFdmVudHM6IG51bGwsXG4vLyAgICAgICAgIF9tZXNzYWdlUXVldWU6IG51bGwsXG4vLyAgICAgICAgIF9leHBpcmVUaW1lb3V0OiBudWxsLFxuLy8gICAgICAgICBfdGltZW91dER1cmF0aW9uOiBudWxsLFxuLy8gICAgICAgfSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=